{"version":3,"file":"templates-list.min.js","sources":["../src/templates-list.js"],"sourcesContent":["// This file is part of the tool_certificate plugin for Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module used when viewing the list of templates\n *\n * @module     tool_certificate/templates-list\n * @copyright  2019 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core_form/modalform', 'core/notification', 'core/str', 'core/ajax', 'core/toast'],\nfunction($, ModalForm, Notification, Str, Ajax, {add: addToast}) {\n\n    /**\n     * Display modal form\n     *\n     * @param {jQuery} triggerElement\n     * @param {String} title\n     * @param {Object} args\n     * @return {ModalForm}\n     */\n    var displayModal = function(triggerElement, title, args) {\n        const modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\details',\n            args: args,\n            modalConfig: {title: title},\n            saveButtonText: Str.get_string('save'),\n            returnFocus: triggerElement[0],\n        });\n        modal.show();\n        return modal;\n    };\n\n    /**\n     * Add template dialogue\n     * @param {Event} e\n     */\n    var displayAddTemplate = function(e) {\n        var contextid = $(e.currentTarget).data('contextid');\n        e.preventDefault();\n        var modal = displayModal($(e.currentTarget), Str.get_string('createtemplate', 'tool_certificate'),\n            {id: 0, contextid: contextid});\n        modal.addEventListener(modal.events.FORM_SUBMITTED, (e) => {\n            e.preventDefault();\n            window.location.href = e.detail.url;\n        });\n    };\n\n    /**\n     * Add template dialogue\n     * @param {Event} e\n     */\n    var displayIssue = function(e) {\n        e.preventDefault();\n        const target = $(e.currentTarget);\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\certificate_issues',\n            args: {tid: target.attr('data-tid')},\n            modalConfig: {title: Str.get_string('issuecertificates', 'tool_certificate'), scrollable: false},\n            saveButtonText: Str.get_string('save'),\n            returnFocus: target,\n        });\n        modal.addEventListener(modal.events.FORM_SUBMITTED, event => {\n            const data = parseInt(event.detail, 10);\n            if (data) {\n                Str.get_strings([\n                    {key: 'oneissuewascreated', component: 'tool_certificate'},\n                    {key: 'aissueswerecreated', component: 'tool_certificate', param: data}\n                ]).done(function(s) {\n                    var str = data > 1 ? s[1] : s[0];\n                    addToast(str);\n                    return null;\n                }).catch(Notification.exception);\n            } else {\n                Str.get_string('noissueswerecreated', 'tool_certificate').done(function(s) {\n                    addToast(s);\n                    return null;\n                }).catch(Notification.exception);\n            }\n        });\n        modal.show();\n    };\n\n    var duplicateMulticategory = function(e) {\n        e.preventDefault();\n        const target = $(e.currentTarget);\n        const templateId = target.attr('data-id');\n        var modal = new ModalForm({\n            formClass: 'tool_certificate\\\\form\\\\category_selector',\n            args: {id: templateId},\n            modalConfig: {title: Str.get_string('confirm')},\n            saveButtonText: Str.get_string('duplicate', 'tool_certificate'),\n            returnFocus: target,\n        });\n        modal.addEventListener(modal.events.FORM_SUBMITTED, function() {\n            window.location.reload();\n        });\n        modal.show();\n    };\n\n    var duplicateSinglecategory = function(e) {\n        e.preventDefault();\n        const templateId = $(e.currentTarget).attr('data-id');\n        Str.get_strings([\n            {key: 'confirm', component: 'moodle'},\n            {key: 'duplicatetemplateconfirm', component: 'tool_certificate', param: $(e.currentTarget).attr('data-name')},\n            {key: 'duplicate', component: 'tool_certificate'},\n            {key: 'cancel', component: 'moodle'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_duplicate_template',\n                        args: {id: templateId}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    var deleteTemplate = function(e) {\n        e.preventDefault();\n        const templateId = $(e.currentTarget).attr('data-id');\n        Str.get_strings([\n            {key: 'confirm', component: 'moodle'},\n            {key: 'deletetemplateconfirm', component: 'tool_certificate', param: $(e.currentTarget).attr('data-name')},\n            {key: 'delete', component: 'moodle'},\n            {key: 'cancel', component: 'moodle'}\n        ]).done(function(s) {\n            Notification.confirm(s[0], s[1], s[2], s[3], function() {\n                var promises = Ajax.call([\n                    {methodname: 'tool_certificate_delete_template',\n                        args: {id: templateId}}\n                ]);\n                promises[0].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            });\n        }).fail(Notification.exception);\n    };\n\n    return {\n        /**\n         * Init page\n         */\n        init: function() {\n            // Add button is not inside a tab, so we can't use Tab.addButtonOnClick .\n            $('body')\n                .on('click', '[data-element=\"addbutton\"]', displayAddTemplate)\n                .on('click', '[data-action=\"issue\"]', displayIssue)\n                .on('click', '[data-action=\"duplicate\"][data-selectcategory=\"1\"]', duplicateMulticategory)\n                .on('click', '[data-action=\"duplicate\"][data-selectcategory=\"0\"]', duplicateSinglecategory)\n                .on('click', '[data-action=\"delete\"]', deleteTemplate);\n        }\n    };\n});\n\n"],"names":["define","$","ModalForm","Notification","Str","Ajax","add","addToast","displayAddTemplate","e","contextid","currentTarget","data","preventDefault","modal","triggerElement","title","args","formClass","modalConfig","saveButtonText","get_string","returnFocus","show","displayModal","id","addEventListener","events","FORM_SUBMITTED","window","location","href","detail","url","displayIssue","target","tid","attr","scrollable","event","parseInt","get_strings","key","component","param","done","s","str","catch","exception","duplicateMulticategory","templateId","reload","duplicateSinglecategory","confirm","call","methodname","fail","deleteTemplate","init","on"],"mappings":";;;;;;;AAsBAA,yCAAO,CAAC,SAAU,sBAAuB,oBAAqB,WAAY,YAAa,eACvF,SAASC,EAAGC,UAAWC,aAAcC,IAAKC,eAAOC,IAAKC,mBA0B9CC,mBAAqB,SAASC,OAC1BC,UAAYT,EAAEQ,EAAEE,eAAeC,KAAK,aACxCH,EAAEI,qBACEC,MAnBW,SAASC,eAAgBC,MAAOC,YACzCH,MAAQ,IAAIZ,UAAU,CACxBgB,UAAW,kCACXD,KAAMA,KACNE,YAAa,CAACH,MAAOA,OACrBI,eAAgBhB,IAAIiB,WAAW,QAC/BC,YAAaP,eAAe,YAEhCD,MAAMS,OACCT,MAUKU,CAAavB,EAAEQ,EAAEE,eAAgBP,IAAIiB,WAAW,iBAAkB,oBAC1E,CAACI,GAAI,EAAGf,UAAWA,YACvBI,MAAMY,iBAAiBZ,MAAMa,OAAOC,gBAAiBnB,IACjDA,EAAEI,iBACFgB,OAAOC,SAASC,KAAOtB,EAAEuB,OAAOC,QAQpCC,aAAe,SAASzB,GACxBA,EAAEI,uBACIsB,OAASlC,EAAEQ,EAAEE,mBACfG,MAAQ,IAAIZ,UAAU,CACtBgB,UAAW,6CACXD,KAAM,CAACmB,IAAKD,OAAOE,KAAK,aACxBlB,YAAa,CAACH,MAAOZ,IAAIiB,WAAW,oBAAqB,oBAAqBiB,YAAY,GAC1FlB,eAAgBhB,IAAIiB,WAAW,QAC/BC,YAAaa,SAEjBrB,MAAMY,iBAAiBZ,MAAMa,OAAOC,gBAAgBW,cAC1C3B,KAAO4B,SAASD,MAAMP,OAAQ,IAChCpB,KACAR,IAAIqC,YAAY,CACZ,CAACC,IAAK,qBAAsBC,UAAW,oBACvC,CAACD,IAAK,qBAAsBC,UAAW,mBAAoBC,MAAOhC,QACnEiC,MAAK,SAASC,OACTC,IAAMnC,KAAO,EAAIkC,EAAE,GAAKA,EAAE,UAC9BvC,SAASwC,KACF,QACRC,MAAM7C,aAAa8C,WAEtB7C,IAAIiB,WAAW,sBAAuB,oBAAoBwB,MAAK,SAASC,UACpEvC,SAASuC,GACF,QACRE,MAAM7C,aAAa8C,cAG9BnC,MAAMS,QAGN2B,uBAAyB,SAASzC,GAClCA,EAAEI,uBACIsB,OAASlC,EAAEQ,EAAEE,eACbwC,WAAahB,OAAOE,KAAK,eAC3BvB,MAAQ,IAAIZ,UAAU,CACtBgB,UAAW,4CACXD,KAAM,CAACQ,GAAI0B,YACXhC,YAAa,CAACH,MAAOZ,IAAIiB,WAAW,YACpCD,eAAgBhB,IAAIiB,WAAW,YAAa,oBAC5CC,YAAaa,SAEjBrB,MAAMY,iBAAiBZ,MAAMa,OAAOC,gBAAgB,WAChDC,OAAOC,SAASsB,YAEpBtC,MAAMS,QAGN8B,wBAA0B,SAAS5C,GACnCA,EAAEI,uBACIsC,WAAalD,EAAEQ,EAAEE,eAAe0B,KAAK,WAC3CjC,IAAIqC,YAAY,CACZ,CAACC,IAAK,UAAWC,UAAW,UAC5B,CAACD,IAAK,2BAA4BC,UAAW,mBAAoBC,MAAO3C,EAAEQ,EAAEE,eAAe0B,KAAK,cAChG,CAACK,IAAK,YAAaC,UAAW,oBAC9B,CAACD,IAAK,SAAUC,UAAW,YAC5BE,MAAK,SAASC,GACb3C,aAAamD,QAAQR,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAAI,WAC1BzC,KAAKkD,KAAK,CACrB,CAACC,WAAY,sCACTvC,KAAM,CAACQ,GAAI0B,eAEV,GAAGN,MAAK,WACbhB,OAAOC,SAASsB,YACjBK,KAAKtD,aAAa8C,iBAE1BQ,KAAKtD,aAAa8C,YAGrBS,eAAiB,SAASjD,GAC1BA,EAAEI,uBACIsC,WAAalD,EAAEQ,EAAEE,eAAe0B,KAAK,WAC3CjC,IAAIqC,YAAY,CACZ,CAACC,IAAK,UAAWC,UAAW,UAC5B,CAACD,IAAK,wBAAyBC,UAAW,mBAAoBC,MAAO3C,EAAEQ,EAAEE,eAAe0B,KAAK,cAC7F,CAACK,IAAK,SAAUC,UAAW,UAC3B,CAACD,IAAK,SAAUC,UAAW,YAC5BE,MAAK,SAASC,GACb3C,aAAamD,QAAQR,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAAI,WAC1BzC,KAAKkD,KAAK,CACrB,CAACC,WAAY,mCACTvC,KAAM,CAACQ,GAAI0B,eAEV,GAAGN,MAAK,WACbhB,OAAOC,SAASsB,YACjBK,KAAKtD,aAAa8C,iBAE1BQ,KAAKtD,aAAa8C,kBAGlB,CAIHU,KAAM,WAEF1D,EAAE,QACG2D,GAAG,QAAS,6BAA8BpD,oBAC1CoD,GAAG,QAAS,wBAAyB1B,cACrC0B,GAAG,QAAS,qDAAsDV,wBAClEU,GAAG,QAAS,qDAAsDP,yBAClEO,GAAG,QAAS,yBAA0BF"}